{% extends "base_1.html" %}
{% load static %}

{% block title %}Affiliates Program{% endblock %}

{% block content %}
<!-- Block 180 - Affiliates Header Totals -->
<div id="block_180">
  <div class="block-bg"></div>
  <div class="container-fluid">
    <div class="totals ">
      <div class="row align-items-start justify-content-start">
        <div class="col-lg-6 col-sm-12 mb-2 mt-2">
          <div class="card h-100"
            style="background: none; color: inherit; padding-top: 24px; padding-bottom: 24px; border-top-left-radius: 2px; border-bottom-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-top-width: 0px; box-shadow: 0px 8px 32px 0px var(--color-id-198); border-style: solid;">
            <div class="totals-block__card">
              <div class="totals-block__card-left">
                <div
                  class="totals-block__icon-preview style-bg-primary-alpha-10 style-border-radius-default style-text-primary">
                  <span class="totals-block__icon style-text-primary fas fa-link"
                    style="font-size: 38px; transform: rotate(0deg); text-shadow: none; border-radius: 0px;"></span>
                </div>
              </div>
              <div class="totals-block__card-right">
                <div class="totals-block__count">
                  <h2 class="totals-block__count-value style-text-primary">{{ affiliate.referral_code|default:"qve94" }}</h2>
                </div>
                <div class="totals-block__card-name">
                  <p>Your Referral Code</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-lg-6 col-sm-12 mb-2 mt-2">
          <div class="card h-100"
            style="background: none; color: inherit; padding-top: 24px; padding-bottom: 24px; border-top-left-radius: 2px; border-bottom-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-top-width: 0px; box-shadow: 0px 8px 32px 0px var(--color-id-198); border-style: solid;">
            <div class="totals-block__card">
              <div class="totals-block__card-left">
                <div
                  class="totals-block__icon-preview style-bg-primary-alpha-10 style-border-radius-default style-text-primary">
                  <span class="totals-block__icon style-text-primary fas fa-percent"
                    style="font-size: 38px; transform: rotate(0deg); text-shadow: none; border-radius: 0px;"></span>
                </div>
              </div>
              <div class="totals-block__card-right">
                <div class="totals-block__count">
                  <h2 class="totals-block__count-value style-text-primary">{{ commission_rate|default:"10" }}%</h2>
                </div>
                <div class="totals-block__card-name">
                  <p>Commission Rate</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-lg-6 col-sm-12 mb-2 mt-2">
          <div class="card h-100"
            style="background: none; color: inherit; padding-top: 24px; padding-bottom: 24px; border-top-left-radius: 2px; border-bottom-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-top-width: 0px; box-shadow: 0px 8px 32px 0px var(--color-id-198); border-style: solid;">
            <div class="totals-block__card">
              <div class="totals-block__card-left">
                <div
                  class="totals-block__icon-preview style-bg-primary-alpha-10 style-border-radius-default style-text-primary">
                  <span class="totals-block__icon style-text-primary fas fa-users"
                    style="font-size: 38px; transform: rotate(0deg); text-shadow: none; border-radius: 0px;"></span>
                </div>
              </div>
              <div class="totals-block__card-right">
                <div class="totals-block__count">
                  <h2 class="totals-block__count-value style-text-primary">{{ total_referrals|default:"0" }}</h2>
                </div>
                <div class="totals-block__card-name">
                  <p>Total Referrals</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-lg-6 col-sm-12 mb-2 mt-2">
          <div class="card h-100"
            style="background: none; color: inherit; padding-top: 24px; padding-bottom: 24px; border-top-left-radius: 2px; border-bottom-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-top-width: 0px; box-shadow: 0px 8px 32px 0px var(--color-id-198); border-style: solid;">
            <div class="totals-block__card">
              <div class="totals-block__card-left">
                <div
                  class="totals-block__icon-preview style-bg-primary-alpha-10 style-border-radius-default style-text-primary">
                  <span class="totals-block__icon style-text-primary fas fa-money-bill-wave"
                    style="font-size: 38px; transform: rotate(0deg); text-shadow: none; border-radius: 0px;"></span>
                </div>
              </div>
              <div class="totals-block__card-right">
                <div class="totals-block__count">
                  <h2 class="totals-block__count-value style-text-primary">NGN {{ available_earnings|default:"0.00" }}</h2>
                </div>
                <div class="totals-block__card-name">
                  <p>Available Earnings</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Block 297 - Referral Link Section -->
<div id="block_297">
  <div class="block-bg"></div>
  <div class="container">
    <div class="text-block-2-columns ">
      <div class="row">
        <div class="col-12">
          <div class="affiliates-info">
            <div class="row affiliates-info__alignment affiliate-block__main-table">
              <div class="col-lg-12">
                <div class="orders-history__margin-search component_card">
                  <div class="card">
                    <div class="p-4">
                      <h3 class="mb-4">Your Referral Link</h3>
                      <div class="table-bg affiliates-info__data-table component_table_link ">
                        <div class="table-wr table-responsive">
                          <table class="table">
                            <thead>
                              <tr>
                                <th>Referral link</th>
                                <th>Commission rate</th>
                                <th>Minimum payout</th>
                              </tr>
                            </thead>
                            <tbody>
                              <tr>
                                <td data-label="Referral link" nowrap>
                                  <span id="referral-link" class="mr-2">https://{{ request.get_host }}/ref/{{ affiliate.referral_code|default:"qve94" }}</span>
                                  <a href="#" class="copy-link" data-clipboard-target="#referral-link">
                                    <span class="fas fa-clone" style="color: var(--color-id-200);" title="Copy link"></span>
                                  </a>
                                </td>
                                <td data-label="Commission rate">{{ commission_rate|default:"10" }}%</td>
                                <td data-label="Minimum payout">NGN {{ min_payout|default:"1000.00" }}</td>
                              </tr>
                            </tbody>
                          </table>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Block 298 - Statistics Section -->
<div id="block_298">
  <div class="block-bg"></div>
  <div class="container">
    <div class="text-block-2-columns ">
      <div class="row">
        <div class="col-12">
          <div class="affiliates-info">
            <div class="row affiliates-info__alignment">
              <div class="col-lg-12">
                <div class="orders-history__margin-search component_card">
                  <div class="card">
                    <div class="p-4">
                      <h3 class="mb-4">Affiliate Statistics</h3>
                      <div class="table-bg component_table_statistics ">
                        <div class="table-wr table-responsive">
                          <table class="table">
                            <thead>
                              <tr>
                                <th>Visits</th>
                                <th>Registrations</th>
                                <th>Referrals</th>
                                <th>Conversion rate</th>
                                <th>Total earnings</th>
                                <th>Available earnings</th>
                              </tr>
                            </thead>
                            <tbody>
                              <tr class="affiliates-table-border-none">
                                <td data-label="Visits">{{ total_visits|default:"0" }}</td>
                                <td data-label="Registrations">{{ total_registrations|default:"0" }}</td>
                                <td data-label="Referrals">{{ total_referrals|default:"0" }}</td>
                                <td data-label="Conversion rate">
                                  {% if total_visits and total_visits > 0 %}
                                    {{ conversion_rate|floatformat:2 }}%
                                  {% else %}
                                    0.00%
                                  {% endif %}
                                </td>
                                <td data-label="Total earnings">NGN {{ total_earnings|default:"0.00" }}</td>
                                <td data-label="Available earnings">NGN {{ available_earnings|default:"0.00" }}</td>
                              </tr>
                            </tbody>
                          </table>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Block 116 - Payout History -->
<div id="block_116">
  <div class="block-bg"></div>
  <div class="container-fluid">
    <div class="orders-history ">
      <div class="row">
        <div class="col-12">
          <div class="orders-history__margin-search component_card">
            <div class="card">
              <div class="p-4">
                <h3 class="mb-4">Payout History</h3>
                <div class="table-bg affiliate-block__table-payments component_table ">
                  <div class="table-wr table-responsive">
                    <table class="table">
                      <thead>
                        <tr>
                          <th>Payout date</th>
                          <th>Payout amount</th>
                          <th>Payout status</th>
                        </tr>
                      </thead>
                      <tbody>
                        {% if payouts %}
                          {% for payout in payouts %}
                          <tr>
                            <td>{{ payout.created_at|date:"Y-m-d H:i" }}</td>
                            <td>NGN {{ payout.amount }}</td>
                            <td>
                              <span class="badge {% if payout.status == 'completed' %}badge-success{% elif payout.status == 'pending' %}badge-warning{% elif payout.status == 'failed' %}badge-danger{% endif %}">
                                {{ payout.get_status_display }}
                              </span>
                            </td>
                          </tr>
                          {% endfor %}
                        {% else %}
                        <tr>
                          <td colspan="3" class="text-center py-4">No payout history found</td>
                        </tr>
                        {% endif %}
                      </tbody>
                    </table>
                  </div>
                </div>
                
                <!-- Pagination -->
                {% if is_paginated %}
                <div class="row mt-4">
                  <div class="col-12">
                    <nav class="component_pagination">
                      <ul class="pagination justify-content-center">
                        {% if page_obj.has_previous %}
                        <li class="page-item">
                          <a class="page-link" href="?page={{ page_obj.previous_page_number }}">Previous</a>
                        </li>
                        {% endif %}
                        
                        {% for num in page_obj.paginator.page_range %}
                          {% if page_obj.number == num %}
                          <li class="page-item active"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
                          {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                          <li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
                          {% endif %}
                        {% endfor %}
                        
                        {% if page_obj.has_next %}
                        <li class="page-item">
                          <a class="page-link" href="?page={{ page_obj.next_page_number }}">Next</a>
                        </li>
                        {% endif %}
                      </ul>
                    </nav>
                  </div>
                </div>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_scripts %}
{{ block.super }}
<script type="text/javascript">
  window.modules.layouts = {
    "theme_id": 21,
    "auth": 1,
    "live": true,
    "csrftoken": "{{ csrf_token }}"
  };
</script>
<script type="text/javascript">
  document.addEventListener('DOMContentLoaded', function() {
    // Copy link functionality
    const copyLinks = document.querySelectorAll('.copy-link');
    
    copyLinks.forEach(link => {
      link.addEventListener('click', function(e) {
        e.preventDefault();
        
        const targetId = this.getAttribute('data-clipboard-target');
        const targetElement = document.querySelector(targetId);
        
        if (targetElement) {
          // Create temporary input
          const tempInput = document.createElement('input');
          tempInput.value = targetElement.textContent.trim();
          document.body.appendChild(tempInput);
          
          // Select and copy
          tempInput.select();
          document.execCommand('copy');
          document.body.removeChild(tempInput);
          
          // Show tooltip or alert
          const originalTitle = this.querySelector('span').title;
          this.querySelector('span').title = 'Copied!';
          
          setTimeout(() => {
            this.querySelector('span').title = originalTitle;
          }, 2000);
        }
      });
    });
  });
</script>
<script type="text/javascript">
  window.modules.user_app_show_config = [];
</script>
<script type="text/javascript">
  window.modules.alerts = { "alerts": [] };
</script>
{% endblock %}